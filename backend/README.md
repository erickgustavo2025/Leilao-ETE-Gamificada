<div align="center">

```
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— 
â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•      â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
â•šâ•â•â•â•â•â•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•     â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•
```

# ğŸ° ETE Gamificada 2026.

### O Game AcadÃªmico Oficial da ETE Gil Rodrigues

[![Status](https://img.shields.io/badge/STATUS-ONLINE-00ff88?style=for-the-badge&logo=statuspage&logoColor=black)](https://etegamificada.online)
[![DomÃ­nio](https://img.shields.io/badge/ğŸŒ_DOMÃNIO-etegamificada.online-6366f1?style=for-the-badge)](https://etegamificada.online)
[![React](https://img.shields.io/badge/React_18-61DAFB?style=for-the-badge&logo=react&logoColor=black)](https://reactjs.org/)
[![Node.js](https://img.shields.io/badge/Node.js-339933?style=for-the-badge&logo=nodedotjs&logoColor=white)](https://nodejs.org/)
[![MongoDB](https://img.shields.io/badge/MongoDB-47A248?style=for-the-badge&logo=mongodb&logoColor=white)](https://mongodb.com/)
[![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)](https://docker.com/)

**Plataforma full-stack de gamificaÃ§Ã£o educacional que transforma o ambiente escolar em um RPG de verdade.**  
Economia real com PC$, sistema de Ranks, LeilÃµes ao vivo, Buffs de multiplicaÃ§Ã£o e guerra trimestral entre turmas.

</div>

---

## ğŸ“– Ãndice

- [VisÃ£o Geral](#-visÃ£o-geral)
- [Stack TecnolÃ³gica](#-stack-tecnolÃ³gica)
- [Arquitetura do Sistema](#-arquitetura-do-sistema)
- [Pilares do Sistema](#-pilares-do-sistema)
- [Regras de NegÃ³cio Cruciais](#-regras-de-negÃ³cio-cruciais)
- [Estrutura de Pastas](#-estrutura-de-pastas)
- [VariÃ¡veis de Ambiente](#-variÃ¡veis-de-ambiente)
- [Guia de InstalaÃ§Ã£o & Deploy](#-guia-de-instalaÃ§Ã£o--deploy)
- [Endpoints da API](#-endpoints-da-api)
- [Tipos de UsuÃ¡rio & PermissÃµes](#-tipos-de-usuÃ¡rio--permissÃµes)
- [Sistema de Ranks](#-sistema-de-ranks)

---

## ğŸ® VisÃ£o Geral

A **ETE Gamificada** nasceu de uma visÃ£o simples e ambiciosa: transformar o cotidiano escolar em uma experiÃªncia de RPG completa, onde cada nota, cada participaÃ§Ã£o e cada conquista vira poder real dentro do sistema.

O aluno nÃ£o Ã© mais apenas um nÃºmero no diÃ¡rio â€” ele Ã© um jogador com saldo, inventÃ¡rio, habilidades e rank. Professores e monitores tÃªm ferramentas de gestÃ£o para recompensar e penalizar. O Admin controla o mundo. E a turma inteira compete pela glÃ³ria da TaÃ§a das Casas.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     FLUXO PRINCIPAL                             â”‚
â”‚                                                                 â”‚
â”‚  Professor â†’ LanÃ§a Pontos â†’ Sistema verifica Buffs Ativos       â”‚
â”‚                          â†“                                      â”‚
â”‚              2x ou 3x multiplicado automaticamente              â”‚
â”‚                          â†“                                      â”‚
â”‚          +0.5x se tiver BÃªnÃ§Ã£o de Merlin (cargo secreto)        â”‚
â”‚                          â†“                                      â”‚
â”‚        PC$ creditado â†’ Rank atualizado â†’ Skills desbloqueadas   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ Stack TecnolÃ³gica

### Frontend
| Tecnologia | VersÃ£o | Uso |
|:---|:---:|:---|
| **React** | 18 | UI declarativa com Hooks |
| **Vite** | latest | Build ultrarrÃ¡pido e HMR |
| **TypeScript** | 5+ | Tipagem estÃ¡tica em todo o frontend |
| **Tailwind CSS** | 3 | Design Pixelado/Neon via utility classes |
| **Framer Motion** | 10+ | AnimaÃ§Ãµes fluidas (accordion, modais, partÃ­culas) |
| **TanStack Query** | v5 | Cache de servidor, mutations e sincronizaÃ§Ã£o em tempo real |
| **React Router** | v6 | Roteamento SPA |
| **Lucide React** | latest | Ãcones consistentes |
| **Sonner** | latest | Toast notifications |

### Backend
| Tecnologia | VersÃ£o | Uso |
|:---|:---:|:---|
| **Node.js** | 18+ | Runtime do servidor |
| **Express** | 4 | Framework HTTP |
| **MongoDB** | 6+ | Banco de dados principal (coleÃ§Ã£o `alunos`) |
| **Mongoose** | 7+ | ODM com schemas tipados |
| **Socket.io** | 4 | LeilÃµes em tempo real (WebSocket) |
| **JWT** | - | AutenticaÃ§Ã£o stateless |
| **bcryptjs** | - | Hash de senhas |
| **Multer** | - | Upload de imagens (avatares, itens, logo) |

### Infraestrutura
| Tecnologia | Uso |
|:---|:---|
| **Docker & Docker Compose** | OrquestraÃ§Ã£o de containers (API + Nginx) |
| **Nginx** | Serve o build estÃ¡tico do Vite + proxy reverso para a API |
| **Volume Docker** | PersistÃªncia de `/uploads` entre reinicializaÃ§Ãµes |

---

## ğŸ—ï¸ Arquitetura do Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        etegamificada.online                         â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   NGINX (Container)  â”‚      â”‚    Node.js API (Container)    â”‚   â”‚
â”‚  â”‚                      â”‚      â”‚                               â”‚   â”‚
â”‚  â”‚  /dist (Vite Build)  â”‚â”€â”€â”€â”€â”€â–¶â”‚  /api/*  (Express Routes)    â”‚   â”‚
â”‚  â”‚  React SPA           â”‚      â”‚  Socket.io (LeilÃ£o WS)        â”‚   â”‚
â”‚  â”‚  index.html fallback â”‚      â”‚  Multer (Uploads)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                               â”‚                     â”‚
â”‚                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                                 â”‚    MongoDB (Atlas/Local)    â”‚     â”‚
â”‚                                 â”‚                             â”‚     â”‚
â”‚                                 â”‚  Collection: alunos         â”‚     â”‚
â”‚                                 â”‚  Collection: storeitems     â”‚     â”‚
â”‚                                 â”‚  Collection: tickets        â”‚     â”‚
â”‚                                 â”‚  Collection: auctions       â”‚     â”‚
â”‚                                 â”‚  Collection: classrooms     â”‚     â”‚
â”‚                                 â”‚  Collection: logs           â”‚     â”‚
â”‚                                 â”‚  Collection: systemconfigs  â”‚     â”‚
â”‚                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Fluxo de AutenticaÃ§Ã£o

```
Aluno â†’ POST /auth/login  â†’  JWT gerado  â†’  Salvo em localStorage
                                             com prefixo @ETEGamificada:token

Toda requisiÃ§Ã£o protegida â†’  Header: Authorization: Bearer <token>
                         â†’  Middleware verifica e injeta req.user
```

---

## ğŸš€ Pilares do Sistema

### ğŸ’° 1. Economia & ETE Bank

O coraÃ§Ã£o do sistema. Tudo gira em torno do **PC$ (Pontos de Conhecimento)**.

- **Ganho de PC$:** Professores e Monitores lanÃ§am pontos diretamente na conta dos alunos. O valor Ã© processado com os multiplicadores ativos antes de ser creditado.
- **ETE Bank:** EmprÃ©stimos disponÃ­veis para alunos VIP (que possuem o VIP Card no inventÃ¡rio). Limite de atÃ© 1/3 do `maxPcAchieved`. Juros de 15% aplicados apÃ³s 7 dias.
- **TransferÃªncias (PIX Escolar):** Envio de PC$ entre alunos via nÃºmero de matrÃ­cula. 100% rastreÃ¡vel nos logs.
- **Limite Financeiro Anual:** Cada aluno tem um teto de recebimento por ano (`receivedThisYear`) para evitar abuso. Resetado automaticamente em virada de ano.
- **DÃ­vidas:** Saldo negativo bloqueia novas compras na loja atÃ© ser quitado.

```javascript
// LÃ³gica de multiplicaÃ§Ã£o (backend/controllers/userController.js)
const getMultiplier = (user) => {
  const now = new Date();
  const activeBuffs = (user.activeBuffs || []).filter(b => 
    !b.expiresAt || new Date(b.expiresAt) > now
  );
  const hasTriple = activeBuffs.some(b => b.effect === 'TRIPLICADOR');
  const hasDouble = !hasTriple && activeBuffs.some(b => b.effect === 'DUPLICADOR');
  
  let multiplier = hasTriple ? 3 : hasDouble ? 2 : 1;
  
  // A BÃªnÃ§Ã£o de Merlin: +0.5x sobre qualquer multiplicador
  if (user.cargos?.includes('bencao_de_merlin')) multiplier += 0.5;
  
  return multiplier;
};
```

---

### ğŸ’ 2. Sistema de Buffs & Auras

Um dos sistemas mais sofisticados: itens que ao serem **usados na Mochila**, nÃ£o geram ticket â€” eles se transformam em **auras passivas** no array `activeBuffs` do usuÃ¡rio.

| Buff | Efeito | DuraÃ§Ã£o |
|:---|:---|:---:|
| **Dobrador (2x)** | Dobra todos os ganhos de PC$ | 90 dias |
| **Triplicador (3x)** | Triplica todos os ganhos de PC$ | 90 dias |
| **BÃªnÃ§Ã£o de Merlin** | +0.5x fixo sobre qualquer multiplicador | Permanente (cargo) |

**Regras:**
- SÃ³ 1 buff do mesmo tipo pode estar ativo. Ativar um novo **substitui** o anterior.
- Buffs sÃ£o limpos automaticamente no `pre('save')` do Model `User.js`.
- O multiplicador Ã© calculado em tempo de execuÃ§Ã£o no lanÃ§amento de pontos â€” nÃ£o Ã© um campo salvo.

---

### ğŸ† 3. TaÃ§a das Casas

A competiÃ§Ã£o trimestral entre turmas. Cada PC$ ganho por um aluno soma para o placar da sua "Casa" (turma).

**Componentes:**
- **Placar em Tempo Real:** Soma de PC$ de todos os alunos da sala.
- **Beco Diagonal:** SeÃ§Ã£o especial da loja onde itens comprados vÃ£o para o `roomInventory` da sala (model `Classroom`), beneficiando a turma na competiÃ§Ã£o.
- **Controle do Admin:** O placar pode ser **ocultado** nas semanas finais para suspense â€” configurado em `SystemConfig.becoDiagonalOpen`.
- **Recompensas:** A turma vencedora recebe itens exclusivos e PC$ bÃ´nus distribuÃ­dos pelo Admin.

---

### âš–ï¸ 4. Mercado & LeilÃ£o

**LeilÃ£o Real-Time (Socket.io):**
- Itens exclusivos nÃ£o disponÃ­veis na loja comum.
- Lances em tempo real via WebSocket.
- Suporte a restriÃ§Ãµes por **Rank** (ex: sÃ³ Diamante+) e **Ano Escolar** (ex: sÃ³ 3Âº ano).
- Ao vencer, item vai para o inventÃ¡rio e PC$ Ã© debitado automaticamente.

**Mercado P2P:**
- Alunos anunciam itens da prÃ³pria Mochila com preÃ§o definido.
- Skills de Rank e itens de Sala **nÃ£o podem ser negociados**.

---

### ğŸ›¡ï¸ 5. GovernanÃ§a (Painel Admin)

Controle total do ecossistema:

| FunÃ§Ã£o | DescriÃ§Ã£o |
|:---|:---|
| `maintenanceMode` | Bloqueia acesso de alunos/monitores ao sistema |
| `becoDiagonalOpen` | Ativa/desativa a seÃ§Ã£o Beco na loja dos alunos |
| `vipCode` | CÃ³digo secreto para ativaÃ§Ã£o de status VIP |
| `siteName` / `landingMessage` | PersonalizaÃ§Ã£o da landing page |
| `logoUrl` | Upload e troca da logo do sistema |
| GestÃ£o de Itens | CRUD completo da loja com upload de imagem |
| Logs de Auditoria | Rastreamento de todas as aÃ§Ãµes crÃ­ticas |
| ConfiguraÃ§Ã£o de LeilÃµes | Criar, encerrar e deletar lotes |

**SincronizaÃ§Ã£o Admin â†’ Aluno:**  
A configuraÃ§Ã£o pÃºblica Ã© exposta via `GET /public/config`. O frontend do aluno faz polling a cada 60s para detectar mudanÃ§as (ex: se o Beco for fechado enquanto um aluno estÃ¡ na pÃ¡gina, ele Ã© automaticamente redirecionado).

---

## ğŸ§  Regras de NegÃ³cio Cruciais

> **Leia antes de desenvolver qualquer feature.**

### ğŸ“Š CÃ¡lculo de Rank
O Rank Ã© calculado com base no `maxPcAchieved` â€” o **maior saldo histÃ³rico** do aluno.

```
Aluno tem 5.000 PC$ â†’ Gastou tudo na loja â†’ Saldo atual: 0 PC$
Rank dele: Continua no mesmo nÃ­vel (calculado pelos 5.000 histÃ³ricos)
```

Gastar dinheiro **nunca** rebaixa o rank. O campo `maxPcAchieved` sÃ³ sobe, nunca desce.

### ğŸ–¼ï¸ Image Helper

As URLs de imagem sÃ£o resolvidas dinamicamente no frontend:

```typescript
// utils/imageHelper.ts
export const getImageUrl = (path: string) => {
  if (!path) return '/assets/placeholder.png';
  if (path.startsWith('http')) return path;
  // Remove /api do base URL e aponta para /uploads
  const base = import.meta.env.VITE_API_URL.replace('/api', '');
  return `${base}${path}`;
};
```

### ğŸ” Auth Persistence

```typescript
// Chaves usadas no localStorage
const TOKEN_KEY = '@ETEGamificada:token';
const USER_KEY  = '@ETEGamificada:user';

// Header obrigatÃ³rio para rotas protegidas
Authorization: Bearer <token>
```

### ğŸ”„ Cache (TanStack Query)

O projeto usa React Query para **todos** os dados do servidor. PadrÃµes adotados:

```typescript
// ApÃ³s qualquer mutaÃ§Ã£o que altera dados globais:
queryClient.invalidateQueries({ queryKey: ['storeItems'] });
queryClient.invalidateQueries({ queryKey: queryKeys.admin.config });
queryClient.invalidateQueries({ queryKey: queryKeys.public.config });

// ConfiguraÃ§Ã£o pÃºblica: polling para detectar mudanÃ§as do Admin
useQuery({
  queryKey: queryKeys.public.config,
  queryFn: () => api.get('/public/config').then(r => r.data),
  staleTime: 1000 * 30,     // Considera fresco por 30s
  refetchInterval: 1000 * 60 // Refetch a cada 60s em background
});
```

### ğŸ§¹ Limpeza de Buffs Expirados

Os buffs expirados sÃ£o limpos em **dois momentos**:

1. **Backend:** `pre('save')` no `User.js` â€” filtra antes de qualquer save.
2. **Frontend:** `useMemo` no componente `Mochila.tsx` â€” filtra na renderizaÃ§Ã£o.

Isso garante que mesmo um aluno offline por dias nÃ£o veja buffs fantasmas.

---

## ğŸ“ Estrutura de Pastas

```
ete-gamificada/
â”‚
â”œâ”€â”€ frontend/                          # React App (Vite + TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â””â”€â”€ axios-config.ts        # InstÃ¢ncia axios com interceptors JWT
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ features/              # TransferModal, QRCode, etc.
â”‚   â”‚   â”‚   â”œâ”€â”€ layout/                # AdminLayout, PageTransition
â”‚   â”‚   â”‚   â””â”€â”€ ui/                    # PixelCard, PixelButton
â”‚   â”‚   â”œâ”€â”€ contexts/
â”‚   â”‚   â”‚   â””â”€â”€ AuthContext.tsx        # user, refreshUser, ranks
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â””â”€â”€ useGameSound.ts        # Sons de sucesso/erro
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/                 # AdminConfig, AdminLoja, etc.
â”‚   â”‚   â”‚   â”œâ”€â”€ aluno/                 # Loja, Mochila, Perfil, Ranking
â”‚   â”‚   â”‚   â””â”€â”€ public/               # WikiMap, Landing, Login
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ cn.ts                  # className merge helper
â”‚   â”‚       â”œâ”€â”€ confetti.ts            # triggerSimpleConfetti / triggerEpicConfetti
â”‚   â”‚       â”œâ”€â”€ imageHelper.ts         # getImageUrl (resolve paths dinÃ¢micos)
â”‚   â”‚       â”œâ”€â”€ queryKeys.ts           # Chaves centralizadas do React Query
â”‚   â”‚       â””â”€â”€ rankHelper.ts          # calculateRank(maxPcAchieved, ranks[])
â”‚   â”œâ”€â”€ .env                           # VITE_API_URL
â”‚   â””â”€â”€ vite.config.ts
â”‚
â”œâ”€â”€ backend/                           # Node.js + Express
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â””â”€â”€ skills.js              # SKILLS_CATALOG (todas as skills de rank)
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ authController.js
â”‚   â”‚   â”‚   â”œâ”€â”€ inventoryController.js # useItem (lÃ³gica de buff vs ticket)
â”‚   â”‚   â”‚   â”œâ”€â”€ storeController.js
â”‚   â”‚   â”‚   â”œâ”€â”€ userController.js      # bulkUpdatePoints + getMultiplier()
â”‚   â”‚   â”‚   â””â”€â”€ adminController.js
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ User.js                # Schema principal (inventory, activeBuffs)
â”‚   â”‚   â”‚   â”œâ”€â”€ StoreItem.js           # buffEffect, validadeDias, isHouseItem
â”‚   â”‚   â”‚   â”œâ”€â”€ Ticket.js              # QR Code tickets
â”‚   â”‚   â”‚   â”œâ”€â”€ Classroom.js           # roomInventory (BaÃº da Turma)
â”‚   â”‚   â”‚   â”œâ”€â”€ Auction.js             # LeilÃµes com Socket.io
â”‚   â”‚   â”‚   â”œâ”€â”€ Log.js                 # Auditoria de aÃ§Ãµes
â”‚   â”‚   â”‚   â””â”€â”€ SystemConfig.js        # maintenanceMode, becoDiagonalOpen, etc.
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ user.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ store.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ inventory.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ auction.routes.js
â”‚   â”‚   â”‚   â”œâ”€â”€ public.routes.js       # GET /public/config (sem auth)
â”‚   â”‚   â”‚   â””â”€â”€ admin.routes.js
â”‚   â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”‚   â””â”€â”€ auth.middleware.js     # verifyToken, isAdmin, isDev
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â””â”€â”€ skillService.js        # syncRankSkills(user)
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ uploads/                   # Imagens enviadas (mapeado como volume Docker)
â”‚   â””â”€â”€ .env
â”‚
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ README.md
```

---

## ğŸ”‘ VariÃ¡veis de Ambiente

### Frontend (`.env` na raiz de `/frontend`)

```env
# URL base da API â€” inclui /api no final
VITE_API_URL=https://api.etegamificada.online/api

# Em desenvolvimento local:
# VITE_API_URL=http://localhost:3000/api
```

### Backend (`.env` na raiz de `/backend`)

```env
# Banco de Dados
MONGODB_URI=mongodb+srv://usuario:senha@cluster.mongodb.net/ete-gamificada

# JWT
JWT_SECRET=uma_string_secreta_longa_e_aleatoria_aqui
JWT_EXPIRES_IN=7d

# Servidor
PORT=3000
NODE_ENV=production

# CORS â€” domÃ­nios autorizados (separados por vÃ­rgula)
FRONTEND_URL=https://etegamificada.online,https://www.etegamificada.online

# Email (RecuperaÃ§Ã£o de Senha)
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=seu@email.com
EMAIL_PASS=sua_senha_de_app
```

---

## ğŸ‹ Guia de InstalaÃ§Ã£o & Deploy

### Desenvolvimento Local

```bash
# 1. Clone o repositÃ³rio
git clone https://github.com/seu-usuario/ete-gamificada.git
cd ete-gamificada

# 2. Backend
cd backend
npm install
cp .env.example .env    # Configure as variÃ¡veis
npm run dev             # Nodemon na porta 3000

# 3. Frontend (outro terminal)
cd frontend
npm install
cp .env.example .env    # Configure VITE_API_URL
npm run dev             # Vite na porta 5173
```

### Build de ProduÃ§Ã£o (Manual)

```bash
# Frontend
cd frontend
npm run build           # Gera /dist
# O Nginx irÃ¡ servir os arquivos em /dist

# Backend
cd backend
npm start               # Node.js direto (use PM2 em produÃ§Ã£o)
```

### Deploy com Docker (Recomendado)

```yaml
# docker-compose.yml
version: '3.9'
services:

  api:
    build: ./backend
    container_name: ete_api
    ports:
      - "3000:3000"
    env_file: ./backend/.env
    volumes:
      # CRÃTICO: persiste as imagens entre deploys
      - ./backend/public/uploads:/app/public/uploads
    restart: unless-stopped

  nginx:
    image: nginx:alpine
    container_name: ete_nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./frontend/dist:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - api
    restart: unless-stopped
```

```bash
# Deploy completo em um comando
cd frontend && npm run build && cd ..
docker-compose down && docker-compose up -d --build
```

### ConfiguraÃ§Ã£o Nginx

```nginx
# nginx.conf
server {
    listen 80;
    server_name etegamificada.online www.etegamificada.online;

    root /usr/share/nginx/html;
    index index.html;

    # SPA fallback â€” redireciona todas as rotas para index.html
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Proxy para a API
    location /api {
        proxy_pass http://api:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # WebSocket (Socket.io para LeilÃ£o)
    location /socket.io {
        proxy_pass http://api:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

---

## ğŸ”Œ Endpoints da API

### Base URL
```
https://api.etegamificada.online/api
```

### Auth (`/auth`)

| MÃ©todo | Rota | Auth | DescriÃ§Ã£o |
|:---:|:---|:---:|:---|
| POST | `/auth/login` | âŒ | Login (retorna JWT) |
| POST | `/auth/first-access` | âŒ | Valida matrÃ­cula + data nascimento |
| POST | `/auth/activate` | âŒ | Define senha e email no 1Âº acesso |
| POST | `/auth/forgot-password` | âŒ | Envia email de recuperaÃ§Ã£o |
| POST | `/auth/reset-password` | âŒ | Define nova senha via token |

### UsuÃ¡rios (`/users`)

| MÃ©todo | Rota | Auth | DescriÃ§Ã£o |
|:---:|:---|:---:|:---|
| GET | `/users/classes` | âœ… | Lista todas as turmas |
| GET | `/users/students` | âœ… | Lista alunos (query: `?turma=3A DS`) |
| GET | `/users/me` | âœ… | Dados do usuÃ¡rio logado |
| PUT | `/users/points/bulk` | ğŸ” Admin | Adiciona/remove pontos em massa |
| PUT | `/users/toggle-monitor` | ğŸ” Admin | Promove/rebaixa monitor |
| PUT | `/users/toggle-block` | ğŸ” Admin | Bloqueia/desbloqueia conta |
| PUT | `/users/toggle-special-role` | ğŸ” Admin | Gerencia cargos especiais |
| PUT | `/users/avatar` | âœ… | Upload de avatar (multipart) |
| POST | `/users/redeem-vip` | âœ… | Resgata cÃ³digo VIP |

### Loja (`/store`)

| MÃ©todo | Rota | Auth | DescriÃ§Ã£o |
|:---:|:---|:---:|:---|
| GET | `/store/items` | âœ… | Lista todos os itens da loja |
| POST | `/store/buy/:id` | âœ… | Compra um item |
| POST | `/store/items` | ğŸ” Admin | Cria novo item (multipart) |
| PUT | `/store/items/:id` | ğŸ” Admin | Edita item existente |
| DELETE | `/store/items/:id` | ğŸ” Admin | Remove item |

### InventÃ¡rio (`/inventory`)

| MÃ©todo | Rota | Auth | DescriÃ§Ã£o |
|:---:|:---|:---:|:---|
| GET | `/inventory` | âœ… | Lista inventÃ¡rio pessoal + sala |
| POST | `/inventory/use` | âœ… | Usa item â†’ Gera ticket OU ativa buff |
| POST | `/inventory/use-room` | âœ… | Usa item do baÃº da sala |
| DELETE | `/inventory/item/:slotId` | âœ… | Descarta item pessoal |
| DELETE | `/inventory/room/:slotId` | âœ… | Descarta item da sala (sÃ³ dono) |

### Tickets (`/tickets`)

| MÃ©todo | Rota | Auth | DescriÃ§Ã£o |
|:---:|:---|:---:|:---|
| GET | `/tickets` | âœ… | Lista tickets do usuÃ¡rio |
| POST | `/tickets/validate` | ğŸ” Admin | Valida ticket por hash |
| DELETE | `/tickets/:id` | âœ… | Cancela ticket PENDENTE (devolve item) |

### LeilÃ£o (`/auction`)

| MÃ©todo | Rota | Auth | DescriÃ§Ã£o |
|:---:|:---|:---:|:---|
| GET | `/auction` | âœ… | Lista leilÃµes ativos e finalizados |
| POST | `/auction/bid/:id` | âœ… | DÃ¡ um lance |
| GET | `/auction/history` | âœ… | HistÃ³rico de lances do usuÃ¡rio |
| POST | `/auction` | ğŸ” Admin | Cria lote (multipart) |
| PUT | `/auction/:id/close` | ğŸ” Admin | Encerra leilÃ£o manualmente |
| DELETE | `/auction/:id` | ğŸ” Admin | Remove leilÃ£o |

### Admin & Config (`/admin`, `/public`)

| MÃ©todo | Rota | Auth | DescriÃ§Ã£o |
|:---:|:---|:---:|:---|
| GET | `/admin/config` | ğŸ” Admin | LÃª configuraÃ§Ãµes do sistema |
| PUT | `/admin/config` | ğŸ” Admin | Atualiza config (multipart para logo) |
| GET | `/admin/logs` | ğŸ” Admin | Logs de auditoria (Ãºltimos 100) |
| GET | `/public/config` | âŒ | Config pÃºblica (sem auth) |

---

## ğŸ‘¥ Tipos de UsuÃ¡rio & PermissÃµes

| Role | Acesso | Capacidades |
|:---|:---:|:---|
| `student` | PadrÃ£o | Loja, Mochila, LeilÃ£o, Roleta, Perfil, Ranking |
| `monitor` | Elevado | Tudo do student + lanÃ§ar/remover pontos da prÃ³pria turma |
| `admin` | Total | Tudo + Painel Admin completo, Config do sistema, GestÃ£o de usuÃ¡rios |
| `dev` | MÃ¡ximo | Tudo + nÃ£o pode ser bloqueado, acessa logs de nÃ­vel dev |

### Cargos Especiais (dentro de `student` e `monitor`)

| Cargo | Emoji | Efeito |
|:---|:---:|:---|
| `monitor_disciplina` | ğŸ¤“ | IdentificaÃ§Ã£o visual |
| `monitor_escola` | ğŸ« | IdentificaÃ§Ã£o visual |
| `armada_dumbledore` | ğŸ§™ | IdentificaÃ§Ã£o visual |
| `monitor_biblioteca` | ğŸ“š | IdentificaÃ§Ã£o visual |
| `monitor_quadra` | âš½ | IdentificaÃ§Ã£o visual |
| `banda` | ğŸ¼ | IdentificaÃ§Ã£o visual |
| `representante` | ğŸ«¡ | IdentificaÃ§Ã£o visual |
| `colaborador` | ğŸ® | Dado automaticamente a todos os monitores |
| `estudante_honorario` | ğŸ˜ | IdentificaÃ§Ã£o visual |
| `bencao_de_merlin` | âœ¨ | **+0.5x fixo em todos os ganhos de PC$** |

---

## ğŸ… Sistema de Ranks

Calculado com base em `maxPcAchieved` (recorde histÃ³rico de saldo).

| Rank | MÃ­nimo PC$ | Cor | Emoji |
|:---|---:|:---|:---:|
| Comum | 0 | `text-slate-400` | â€” |
| Bronze | 500 | `text-orange-400` | ğŸ¥‰ |
| Prata | 1.500 | `text-slate-300` | ğŸ¥ˆ |
| Ouro | 3.000 | `text-yellow-400` | ğŸ¥‡ |
| Diamante | 6.000 | `text-cyan-400` | ğŸ’ |
| Ã‰pico | 10.000 | `text-purple-400` | âš¡ |
| LendÃ¡rio | 15.000 | `text-fuchsia-400` | ğŸŒŸ |
| Supremo | 25.000 | `text-red-400` | ğŸ”¥ |
| MitolÃ³gico | 40.000 | `text-rose-400` | ğŸŒ¹ |
| Soberano | 60.000 | `text-yellow-100` | ğŸ‘‘ |

> **Ranks de itens na loja** seguem o mesmo esquema de cores para manter consistÃªncia visual em todo o sistema.

---

<div align="center">

---

**ETE Gamificada 2026** â€” ConstruÃ­do com ğŸ’œ para a ETE Gil Rodrigues

`React` Â· `Node.js` Â· `MongoDB` Â· `Socket.io` Â· `Docker`

*"Transformando educaÃ§Ã£o em conquista."*

[![Stars](https://img.shields.io/github/stars/seu-usuario/ete-gamificada?style=for-the-badge&color=ffd700)](https://github.com/seu-usuario/ete-gamificada)

</div>
